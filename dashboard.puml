@startuml IU Studiennavigator - Vollständiges Klassendiagramm
skinparam classAttributeIconSize 0
skinparam backgroundColor #FEFEFE
skinparam packageStyle rectangle
skinparam linetype ortho

title IU Studiennavigator - Vollständiges Klassendiagramm\n(Stand: Dezember 2025)

' ============================================================================
' LAYER 1: FLASK APPLICATION
' ============================================================================
package "Flask Application" <<Cloud>> {
  class app.py <<application>> {
    + app: Flask
    + login_manager: LoginManager
    + DB_PATH: Path
    --
    **Routes:**
    + /login [GET, POST]
    + /logout
    + /dashboard
    + /semester/<int>
    + /api/book-module [POST]
    + /api/pruefungstermine/<int:modul_id> [GET]
    + /api/pruefung-anmelden [POST]
    --
    **Controllers:**
    + auth_ctrl: AuthController
    + dashboard_ctrl: DashboardController
    + semester_ctrl: SemesterController
    --
    **Repositories:**
    + pruefungstermin_repo: PruefungsterminRepository
    + pruefungsanmeldung_repo: PruefungsanmeldungRepository
  }
}

' ============================================================================
' LAYER 2: CONTROLLERS (Business Logic)
' ============================================================================
package "controllers/" <<Folder>> {

  class AuthController <<control>> {
    - __student_repo: StudentRepository
    --
    + __init__(db_path: str)
    + login(email: str, password: str): dict
    + logout(): dict
  }

  class DashboardController <<control>> {
    - __student_repo: StudentRepository
    - __einschreibung_repo: EinschreibungRepository
    - __progress_repo: ProgressRepository
    - __progress_text: ProgressTextService
    --
    + __init__(db_path: str)
    + get_dashboard_data(login_id: int): dict
  }

  class SemesterController <<control>> {
    - __student_repo: StudentRepository
    - __einschreibung_repo: EinschreibungRepository
    - __modul_repo: ModulRepository
    - __modulbuchung_repo: ModulbuchungRepository
    --
    + __init__(db_path: str)
    + get_modules_for_semester(login_id: int, semester_nr: int): dict
    + book_module(login_id: int, modul_id: int): dict
  }
}

' ============================================================================
' LAYER 3: SERVICES
' ============================================================================
package "services/" <<Folder>> {

  class ProgressTextService <<service>> {
    - json_path: Path
    - texts: dict
    --
    + __init__(json_path: Path)
    + get_grade_text(progress: Progress, lang: str): str
    + get_time_text(progress: Progress, lang: str): str
    + get_fee_text(progress: Progress, lang: str): str
    + get_all_texts(progress: Progress, lang: str): dict
    --
    - __load_texts(): dict
    - __get_fallback_texts(): dict
  }
}

' ============================================================================
' LAYER 4: REPOSITORIES (Data Access)
' ============================================================================
package "repositories/" <<Folder>> {

  class StudentRepository <<repository>> {
    - __gateway: DBGateway
    --
    + __init__(db_path: str)
    + get_by_id(student_id: int): Student | None
    + get_by_login_id(login_id: int): Student | None
    + get_by_email(email: str): Student | None
  }

  class ModulRepository <<repository>> {
    - db_path: str
    --
    + __init__(db_path: str)
    + get_modules_for_semester(studiengang_id: int, semester: int, student_id: int): List[ModulDTO]
  }

  class EinschreibungRepository <<repository>> {
    - __gateway: DBGateway
    --
    + __init__(db_path: str)
    + get_by_id(einschreibung_id: int): Einschreibung | None
    + get_aktive_by_student(student_id: int): Einschreibung
  }

  class ModulbuchungRepository <<repository>> {
    - __gateway: DBGateway
    --
    + __init__(db_path: str)
    + get_by_id(modulbuchung_id: int): Modulbuchung | None
    + get_by_einschreibung(einschreibung_id: int): List[Modulbuchung]
    + create(modulbuchung: Modulbuchung): int
  }

  class GebuehrRepository <<repository>> {
    - __gateway: DBGateway
    --
    + __init__(db_path: str)
    + get_offene_by_einschreibung(einschreibung_id: int): List[Gebuehr]
    + get_gesamt_offen(einschreibung_id: int): float
  }

  class ProgressRepository <<repository>> {
    - __gateway: DBGateway
    - __gebuehr_repo: GebuehrRepository
    --
    + __init__(db_path: str)
    + get_progress_for_student(student: Student, einschreibung_id: int): Progress
    - __calculate_average_grade(conn, einschreibung_id): Decimal
    - __count_passed_modules(conn, einschreibung_id): int
    - __count_booked_modules(conn, einschreibung_id): int
    - __sum_open_fees(conn, einschreibung_id): Decimal
    - __calculate_progress_based_semester(conn, einschreibung_id): int
  }

  class PruefungsterminRepository <<repository>> {
    - db_path: str
    --
    + __init__(db_path: str)
    + find_by_id(termin_id: int): Pruefungstermin | None
    + find_by_modul(modul_id: int): List[Pruefungstermin]
    + find_verfuegbare_termine(modul_id: int): List[Pruefungstermin]
    + create(termin: Pruefungstermin): int
    + update(termin: Pruefungstermin): bool
    - __get_connection(): Connection
  }

  class PruefungsanmeldungRepository <<repository>> {
    - db_path: str
    --
    + __init__(db_path: str)
    + find_by_id(anmeldung_id: int): Pruefungsanmeldung | None
    + find_by_modulbuchung(modulbuchung_id: int): Pruefungsanmeldung | None
    + create(anmeldung: Pruefungsanmeldung): int
    + update_status(anmeldung_id: int, status: str): bool
    + stornieren(anmeldung_id: int): bool
    - __get_connection(): Connection
  }

  class DBGateway <<persistence>> {
    - db_path: str
    --
    + __init__(db_path: str)
    + execute_query(query: str, params: tuple): List[Row]
    + execute_insert(query: str, params: tuple): int
    + execute_update(query: str, params: tuple): int
    - __get_connection(): Connection
  }
}

' ============================================================================
' LAYER 5: MODELS (Domain Objects)
' ============================================================================
package "models/" <<Folder>> {

  class Student <<entity>> {
    + id: int
    + matrikel_nr: str
    + vorname: str
    + nachname: str
    + login_id: int
    --
    + get_full_name(): str
    + calculate_semester(einschreibung: Einschreibung): int
    + validate(): tuple[bool, str]
    + to_dict(): dict
    + {static} from_db_row(row): Student
    --
    - __get_display_name(): str
  }

  class Login <<entity>> {
    + id: int
    + email: str
    + password_hash: str
    --
    + validate_password(password: str): bool
  }

  class Studiengang <<entity>> {
    + id: int
    + name: str
    + grad: str
    + regel_semester: int
    + beschreibung: str
    --
    + get_full_name(): str
    + is_bachelor(): bool
    + is_master(): bool
    + get_total_ects_target(): int
    + validate(): None
    + to_dict(): dict
    + {static} from_row(row): Studiengang
  }

  class Modul <<entity>> {
    + id: int
    + name: str
    + beschreibung: str
    + ects: int
    --
    + to_dict(): dict
    + {static} from_db_row(row): Modul
  }

  class StudiengangModul <<entity>> {
    + studiengang_id: int
    + modul_id: int
    + semester: int
    + pflichtgrad: str
    --
    + is_pflicht(): bool
    + is_wahlpflicht(): bool
    + is_wahl(): bool
    + is_mandatory(): bool
    + validate(): None
    + to_dict(): dict
    + {static} from_row(row): StudiengangModul
  }

  class Einschreibung <<entity>> {
    + id: int | None
    + student_id: int
    + studiengang_id: int
    + zeitmodell_id: int
    + start_datum: date
    + exmatrikulations_datum: date | None
    + status: str
    --
    + is_active(): bool
    + is_paused(): bool
    + is_exmatriculated(): bool
    + get_study_duration_months(reference_date: date): int
    + validate(): None
    + to_dict(): dict
    + {static} from_row(row): Einschreibung
    --
    - __calculate_months_since_start(reference_date: date): int
  }

  class Modulbuchung <<entity>> {
    + id: int
    + einschreibung_id: int
    + modul_id: int
    + buchungsdatum: date | None
    + status: str
    --
    + is_open(): bool
    + is_passed(): bool
    + is_recognized(): bool
    + to_dict(): dict
    + {static} from_row(row): Modulbuchung
  }

  class Pruefungsleistung <<entity>> {
    + note: Decimal | None
    + pruefungsdatum: date | None
    + versuch: int
    + max_versuche: int
    + anmeldemodus: str
    + thema: str | None
    --
    + has_grade(): bool
    + is_passed(): bool
    + can_retry(): bool
    + get_grade_category(): str
    + to_dict(): dict
    + {static} from_row(row): Pruefungsleistung
  }

  class Gebuehr <<entity>> {
    + id: int | None
    + einschreibung_id: int
    + art: str
    + betrag: Decimal
    + faellig_am: date
    + bezahlt_am: date | None
    --
    + is_paid(): bool
    + is_overdue(reference_date: date): bool
    + is_due_soon(days_ahead: int, reference_date: date): bool
    + get_days_overdue(reference_date: date): int
    + get_days_until_due(reference_date: date): int
    + mark_as_paid(payment_date: date): None
    + get_formatted_amount(): str
    + get_status_text(reference_date: date): str
    + to_dict(): dict
    + {static} from_row(row): Gebuehr
  }

  class Pruefungstermin <<entity>> {
    + id: int
    + modul_id: int
    + datum: date
    + beginn: time | None
    + ende: time | None
    + art: str
    + ort: str | None
    + anmeldeschluss: datetime | None
    + kapazitaet: int | None
    + beschreibung: str | None
    --
    + ist_online_pruefung(): bool
    + ist_praesenz_pruefung(): bool
    + ist_projekt(): bool
    + hat_zeitfenster(): bool
    + hat_kapazitaet(): bool
    + ist_anmeldeschluss_vorbei(): bool
    + ist_in_zukunft(): bool
    + to_dict(): dict
    + {static} from_row(row): Pruefungstermin
  }

  class Pruefungsanmeldung <<entity>> {
    + id: int
    + modulbuchung_id: int
    + pruefungstermin_id: int
    + status: str
    + angemeldet_am: datetime | None
    --
    + ist_aktiv(): bool
    + ist_storniert(): bool
    + ist_absolviert(): bool
    + kann_storniert_werden(): bool
    + to_dict(): dict
    + {static} from_row(row): Pruefungsanmeldung
  }

  class Progress <<dto>> {
    + student_id: int
    + durchschnittsnote: Decimal | None
    + anzahl_bestandene_module: int
    + anzahl_gebuchte_module: int
    + offene_gebuehren: Decimal
    + aktuelles_semester: float
    + erwartetes_semester: float
    --
    + calculate_overall_status(): str
    + get_completion_percentage(total_modules: int): float
    + to_dict(): dict
    --
    - __get_grade_category(): str
    - __has_passing_grade(): bool
    - __calculate_semester_difference(): float
    - __calculate_days_difference(): int
    - __get_time_category(): str
    - __is_on_schedule(): bool
    - __has_open_fees(): bool
    - __get_fee_category(): str
    - __get_open_fees_formatted(): str
  }

  class ModulBuchung <<dto>> {
    + modul: Modul
    + status: str | None
    + buchbar: bool
    + buchungsdatum: str | None
    + note: float | None
    + pflichtgrad: str
    + semester: int
    --
    + is_passed(): bool
    + is_booked(): bool
    + to_dict(): dict
  }

  class User <<flask_login>> {
    + id: int
    + email: str
    --
    + __init__(user_id: int, email: str)
    + {static} get(user_id: int, db_path: str): User | None
    + is_authenticated(): bool
    + is_active(): bool
    + is_anonymous(): bool
    + get_id(): str
  }
}

' ============================================================================
' DATABASE
' ============================================================================
class SQLite3 <<database>> {
  + **dashboard.db**
  --
  **Tabellen:**
  - login
  - student
  - studiengang
  - modul
  - studiengang_modul
  - zeitmodell
  - einschreibung
  - modulbuchung
  - pruefungsleistung
  - gebuehr
  - pruefungsart
  - modul_pruefungsart
  - pruefungstermin
  - pruefungsanmeldung
}

' ============================================================================
' NOTES
' ============================================================================
note right of Einschreibung
  **AGGREGATION zu Student:**
  Lebt unabhängig vom Student
  (Archiv, Buchhaltung)

  **KOMPOSITION:**
  Modulbuchungen sterben
  mit der Einschreibung

  **AGGREGATION:**
  Gebühren leben unabhängig
end note

note right of Student
  **KOMPOSITION zu Login:**
  Student besitzt genau einen Login.
  Login stirbt mit Student.

  **AGGREGATION zu Einschreibung:**
  Student hat Einschreibungen,
  die unabhängig weiterexistieren.
end note

note right of StudiengangModul
  **Assoziationsklasse:**
  Löst M:N-Beziehung zwischen
  Studiengang und Modul auf.

  **KOMPOSITION zu Studiengang:**
  Stirbt mit Studiengang.

  **AGGREGATION zu Modul:**
  Modul lebt unabhängig.
end note

note right of Pruefungsleistung
  **VERERBUNG:**
  IST-EINE Modulbuchung mit
  zusätzlichen Prüfungsdaten.

  **POLYMORPHIE:**
  Überschreibt is_passed()
  und to_dict().
end note

note right of Progress
  **DTO (Data Transfer Object):**
  Aggregiert Fortschrittsdaten
  aus mehreren Quellen.

  Keine direkte DB-Tabelle!
  Wird vom ProgressRepository
  berechnet.
end note

note right of ProgressTextService
  **Service-Klasse:**
  Generiert dynamische Texte
  basierend auf Progress-Daten.

  Lädt progress.json mit
  mehrsprachigen Templates.
end note

' ============================================================================
' FLASK APP → CONTROLLERS
' ============================================================================
app.py --> AuthController : creates & uses
app.py --> DashboardController : creates & uses
app.py --> SemesterController : creates & uses
app.py --> User : uses (Flask-Login)
app.py --> PruefungsterminRepository : uses
app.py --> PruefungsanmeldungRepository : uses

' ============================================================================
' CONTROLLER → REPOSITORY CONNECTIONS
' ============================================================================
AuthController --> StudentRepository : uses

DashboardController --> StudentRepository : uses
DashboardController --> EinschreibungRepository : uses
DashboardController --> ProgressRepository : uses
DashboardController --> ProgressTextService : uses

SemesterController --> StudentRepository : uses
SemesterController --> EinschreibungRepository : uses
SemesterController --> ModulRepository : uses
SemesterController --> ModulbuchungRepository : uses

' ============================================================================
' REPOSITORY → GATEWAY & DATABASE
' ============================================================================
StudentRepository --> DBGateway : uses
EinschreibungRepository --> DBGateway : uses
ModulbuchungRepository --> DBGateway : uses
GebuehrRepository --> DBGateway : uses
ProgressRepository --> DBGateway : uses

ModulRepository ..> SQLite3 : direct SQL access
PruefungsterminRepository ..> SQLite3 : direct SQL access
PruefungsanmeldungRepository ..> SQLite3 : direct SQL access

DBGateway --> SQLite3 : queries

' ============================================================================
' REPOSITORY DEPENDENCIES
' ============================================================================
ProgressRepository --> GebuehrRepository : uses

' ============================================================================
' SERVICE → MODEL CONNECTIONS
' ============================================================================
ProgressTextService ..> Progress : uses

' ============================================================================
' REPOSITORY → MODEL CONNECTIONS
' ============================================================================
StudentRepository ..> Student : creates
ModulRepository ..> Modul : creates
ModulRepository ..> ModulBuchung : creates
EinschreibungRepository ..> Einschreibung : creates
ModulbuchungRepository ..> Modulbuchung : creates
GebuehrRepository ..> Gebuehr : creates
ProgressRepository ..> Progress : creates
PruefungsterminRepository ..> Pruefungstermin : creates
PruefungsanmeldungRepository ..> Pruefungsanmeldung : creates

' ============================================================================
' USER & LOGIN CONNECTION
' ============================================================================
User ..> Login : authenticates via

' ============================================================================
' DOMAIN MODEL RELATIONSHIPS
' ============================================================================
' KOMPOSITION (gefüllte Raute ◆) = Lebensdauerabhängigkeit, "stirbt mit"
Student *-- "1" Login : besitzt
Einschreibung *-- "0..*" Modulbuchung : enthält
Studiengang *-- "1..*" StudiengangModul : definiert

' AGGREGATION (leere Raute ◇) = Lockere Kopplung, "lebt unabhängig"
Student o-- "0..*" Einschreibung : hat
Einschreibung o-- "0..*" Gebuehr : erzeugt
Modul o-- "1..*" StudiengangModul : wird verwendet in
Modul o-- "0..*" Pruefungstermin : hat
Modulbuchung o-- "0..1" Pruefungsanmeldung : ermöglicht

' VERERBUNG (inheritance)
Pruefungsleistung --|> Modulbuchung : erbt von

' ASSOZIATIONEN (fachliche Referenzen)
Einschreibung --> "1" Studiengang : bezieht sich auf
Modulbuchung --> "1" Modul : betrifft
Pruefungsanmeldung --> "1" Pruefungstermin : bezieht sich auf

' ============================================================================
' LEGEND
' ============================================================================
legend right
  |= Symbol |= Bedeutung |
  | <<application>> | Flask Application |
  | <<control>> | Controller (Business Logic) |
  | <<repository>> | Repository (Data Access) |
  | <<entity>> | Domain Model / Entity |
  | <<dto>> | Data Transfer Object |
  | <<service>> | Service Class |
  | <<persistence>> | Database Gateway |
  | <<database>> | Database |
  | <<flask_login>> | Flask-Login User |
  | ---> | uses / depends on |
  | ...> | creates / returns |
  | *-- | Komposition (◆) - stirbt mit |
  | o-- | Aggregation (◇) - lebt unabhängig |
  | --|> | Vererbung (Inheritance) |
  | --> | Assoziation (Referenz) |
  | + | Public (öffentlich) |
  | - | Private (__double_underscore) |

  **OOP-Prinzipien im Projekt:**
  • **Komposition:** Student ◆→ Login, Einschreibung ◆→ Modulbuchung
  • **Aggregation:** Student ◇→ Einschreibung, Einschreibung ◇→ Gebuehr
  • **Vererbung:** Pruefungsleistung extends Modulbuchung
  • **Polymorphie:** Pruefungsleistung.is_passed() überschreibt Modulbuchung.is_passed()
  • **Encapsulation:** Public (+) / Private (-) Methoden in allen Models

  **Architektur-Pattern:**
  • Repository Pattern (für Datenzugriff)
  • MVC (Model-View-Controller)
  • Gateway Pattern (DBGateway)
  • DTO Pattern (Progress, ModulBuchung)
  • Service Layer (ProgressTextService)

  **Besonderheiten:**
  • Automotive Infotainment-Metapher im Frontend
  • SVG-basiertes dynamisches Roadmap-System
  • Two-Stage Dropdown für Prüfungsanmeldung
  • Mehrsprachige Fortschrittstexte (DE/EN)
  • Comprehensive Test Coverage (1000+ Tests)

  **Stand:** Dezember 2025
endlegend

@enduml
